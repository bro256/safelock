{% extends 'base.html' %}
{% load static %}
{% block title %} {{ block.super }} {% endblock title %}
{% block content %}
    {% if passwordentry.id %}
        <h1>Update password info</h1>
    {% else %}
        <h1>New password {{ decrypted_password }}</h1>
    {% endif %}

    {% comment %} <form method = "post" action="{{ request.path }}?password_id={{ password.id }}">
        {% csrf_token %}
        <div class="password-form">
            {{ form.as_p }}
        </div>
        <button type="submit">{% if passwordentry.id %}Update{% else %}Save{% endif %}</button>
        <a href="{% url 'password_entry_list' %}">Go Back</a>
        {% if passwordentry.id %}
            <a href="{% url 'password_entry_to_trash' passwordentry.pk %}">To trash</a>
        {% endif %}
    </form> {% endcomment %}

    <form method="post" action="{{ request.path }}?password_id={{ password.id }}">
        {% csrf_token %}
        <table class="table table-stripped">
            {% comment %} <tr>
                <td>ID:</td>
                <td>{{ object.id }}</td>
            </tr> {% endcomment %}
            <tr>
                <td>Title:</td>
                <td><input type="text" name="title" value="{{ form.title.value|default_if_none:'' }}" required></td>
            </tr>
            <tr>
                <td>Username:</td>
                <td><input type="text" name="username" value="{{ form.username.value|default_if_none:'' }}" required></td>
            </tr>
            <tr>
                <td>Website:</td>
                <td><input type="text" name="website" value="{{ form.website.value|default_if_none:'' }}" required></td>
            </tr>
            <tr>
                <td>Password:</td>
                <td>
                    <input type="password" id="password-field" name="password" value="{{ form.password.value|default_if_none:'' }}">
                    <button type="button" onclick="toggleTextVisibility()">Show</button>
                    <button type="button" onclick="copyToClipboard()">Copy</button>
                    <button type="button" onclick="regeneratePassword()">Generate Password</button>
                </td>
            </tr>
            <tr>
                <td>Is in Bookmarks:</td>
                <td>
                    <input type="checkbox" name="is_in_bookmarks" {% if form.is_in_bookmarks.value %}checked{% endif %}>
                </td>
            </tr>
            {% if passwordentry.id %}
                <tr>
                    <td>Created:</td>
                    <td>{{ object.created_at }}</td>
                </tr>
                <tr>
                    <td>Updated:</td>
                    <td> {{ object.updated_at }}</td>
                </tr>
            {% endif %}
        </table>
        <button type="submit">{% if passwordentry.id %}Update{% else %}Save{% endif %}</button>
        <a href="{% url 'password_entry_list' %}">Go Back</a>
        {% if passwordentry.id %}
            <a href="{% url 'password_entry_to_trash' passwordentry.pk %}">To trash</a>
        {% endif %}
    </form>

    <!-- HTML element to display the generated password -->
    <p id="password-display"></p>

    <!-- Button to regenerate the password -->

    

    {% comment %} <form>
        <input type="text" id="password-field" value="Text to copy">
        <button type="button" onclick="copyToClipboard()">Copy</button>
        <button type="button" onclick="toggleTextVisibility()">Show/Hide</button>
      </form> {% endcomment %}
      

<!-- Scripts -->
<script src="{% static 'secret_manager/js/password_field.js' %}"></script>
{% comment %} <!-- JavaScript code -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Event handler for the regenerate button
        document.getElementById('regenerate-button').addEventListener('click', function() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/generate-password/', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onload = function() {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    // Update the password display element with the new password
                    document.getElementById('password-field').value = response.password;
                }
                else {
                    console.error('Error:', xhr.status);
                }
            };

            xhr.onerror = function() {
                console.error('Request failed.');
            };

            xhr.send();
        });
    });
</script> {% endcomment %}

{% endblock content %}
